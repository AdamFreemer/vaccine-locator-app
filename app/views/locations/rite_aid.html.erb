<%# This will auto-reload the page every 60s %>
<meta http-equiv="refresh" content="60" />
<div class="shadow-sm p-3 mb-6 bg-white rounded">
  <p id="notice"><%= notice %></p>

  <header>
    <div class="blog-header-logo text-dark text-center title-text">National Vaccine Availability</div>
    <br>
    <div class="text-center vaxxmax-logo-text"><%= image_tag("vaccine-logo1-sm.png")%></div>
    <div class="text-dark text-center" href="#">VaxxMax&nbsp;&nbsp;</div>
    <br>

    <div class="row justify-content-between align-items-center">
      <div class="col-12 text-center">
        <div class="blog-header-small text-dark" href="#">
          <code class="text-black">This tool is free, but donations to cover hosting & development costs are welcome. Thanks!</code><br>
          <a href="https://www.paypal.com/donate?business=9SM3XLXSS9RVN&item_name=Help+pay+for+VaxxMaxx+hosting+and+server+costs.&currency_code=USD" target="_blank">
            <button class=" btn btn-md btn-outline-primary">
              <code class="text-dark">Contribute via PayPal</code>
            </button>    
          </a>   
          <button class="btn btn-md btn-outline-primary" id="bitcoin" data-toggle="modal" data-target="#bitcoinModal">
            <code class="text-dark">Contribure via Bitcoin</code>
          </button>                 
        </div>
      </div>
    </div>
    
    <div class="row dropdowns">
      <div class="col-sm">
        <%= select_tag "provider-select", options_for_select(["Rite Aid - Nationwide Locations"], "-"), class: "form-control" %><br>
      </div>
      <div class="col-sm text-center">
        <code class="text-black">Facebook: <a href="https://www.facebook.com/vaxxmax" target="_blank">https://www.facebook.com/vaxxmax</a></code><br>
        <code class="text-black">Data is updated approximately every 5 minutes.</code><br>
          <button class="btn btn-xs btn-outline-primary changelog" id="changelog" data-toggle="modal" data-target="#changelogModal">
            <code class="text-dark">Changelog</code>
          </button>
      </div>
      <div class="col-sm">
        <%= select_tag "state-select", options_for_select(@states, session[:state]), class: "form-control" %>
      </div>
    </div>
  </header>
</div>

<div class="shadow-sm p-3 mb-6 bg-white rounded">
  <p class="text-center">Welcome to VaxxMax. This is the Rite Aid vaccine slot finder page.
    You'll want to go here first: <a href="https://www.riteaid.com/pharmacy/apt-scheduler" target="_blank">https://www.riteaid.com/pharmacy/apt-scheduler</a>.<br>
    After pre-qualifying, find an available location below to copy / past on the Rite Aid page for scheduling.<br>
     <a href="rite-aid-instructions.pdf" target="_blank">Detailed instructions can be found by clicking here.</a>
  </p>


  <p class="text-center">
    The below locations have been recently updated and have the best probability of a slot being open based on the "Last Updated" date field.
  </p>
  
  <div class="table-responsive">
    <table class="table table-striped table-bordered table-condensed" id="locations">
      <thead class="thead-dark">
        <tr>
          <th class="text-center">ID (Website)</th>
          <th class="text-center">Open Slots</th>      
          <th>Clickable Address (Google Maps)</th>
          <th>City</th>
          <th>State</th>
          <th>Zip</th>
          <th>Last Updated</th>
          <th>Became Available</th>
        </tr>
      </thead>

      <tbody>
        <% @locations.each do |location| %>
          <tr>
            <td class="text-center"><%= link_to location.store_number, location&.rite_aid_location_website, target: :_blank %></td>
            <td class="text-center">
              <% if location.slot_1 %>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill text-green" viewBox="0 0 16 16">
                  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>   
              <% else %>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                </svg>           
              <% end %>
            </td>

            <td>
              <%= link_to location.full_address, location.google_search, id: "full-address-#{location.id}", target: :_blank %>
              <button class="btn btn-xs btn-outline-primary" data-clipboard-target="#full-address-<%= location.id %>">
                Copy
              </button>              
            </td>
            <td><%= location.city %></td>
            <td class="text-center"><%= location.state %></td>
            <td class="text-center"><%= location.zip %></td>
            <td><%= location.last_updated&.in_time_zone("Eastern Time (US & Canada)")&.strftime("%m-%e-%Y, %l:%M %p") %></td>
            <td><%= location.when_available&.in_time_zone("Eastern Time (US & Canada)")&.strftime("%m-%e-%Y, %l:%M %p") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>


<% if @locations_old.length > 0 %>
<div class="shadow-sm p-3 mb-5 bg-white rounded">
  <p class="text-center">The below locations are stale and most likely do not have availability.</p>
  <div class="table-responsive">
    <table class="table table-striped table-bordered table-condensed" id="locations">
      <thead class="thead-dark">
        <tr>
          <th class="text-center">ID (Website)</th>
          <th class="text-center">Open Slots</th>      
          <th>Clickable Address (Google Maps)</th>
          <th>City</th>
          <th>State</th>
          <th>Zip</th>
          <th>Last Updated</th>
          <th>Became Available</th>
        </tr>
      </thead>

      <tbody>
        <% @locations_old.each do |location| %>
          <tr>
            <td class="text-center"><%= link_to location.store_number, location&.rite_aid_location_website, target: :_blank %></td>
            <td class="text-center">
              <% if location.slot_1 %>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill text-green" viewBox="0 0 16 16">
                  <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>   
              <% else %>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                </svg>           
              <% end %>
            </td>

            <td>
              <%= link_to location.full_address, location.google_search, id: "full-address-#{location.id}", target: :_blank %>
              <button class="btn btn-xs btn-outline-primary" data-clipboard-target="#full-address-<%= location.id %>">
                Copy
              </button>              
            </td>
            <td><%= location.city %></td>
            <td class="text-center"><%= location.state %></td>
            <td class="text-center"><%= location.zip %></td>
            <td><%= location.last_updated&.in_time_zone("Eastern Time (US & Canada)")&.strftime("%m-%e-%Y, %l:%M %p") %></td>
            <td><%= location.when_available&.in_time_zone("Eastern Time (US & Canada)")&.strftime("%m-%e-%Y, %l:%M %p") %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
<% end %>
